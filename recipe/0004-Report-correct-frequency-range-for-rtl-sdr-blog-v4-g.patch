From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Ryan Volz <ryan.volz@gmail.com>
Date: Wed, 30 Aug 2023 11:55:09 -0400
Subject: [PATCH] Report correct frequency range for rtl-sdr-blog v4 (goes down
 to 0)

---
 lib/rtl/rtl_source_c.cc | 19 ++++++++++++-------
 lib/rtl/rtl_source_c.h  |  1 +
 2 files changed, 13 insertions(+), 7 deletions(-)

diff --git a/lib/rtl/rtl_source_c.cc b/lib/rtl/rtl_source_c.cc
index 5e3306b..436f9de 100644
--- a/lib/rtl/rtl_source_c.cc
+++ b/lib/rtl/rtl_source_c.cc
@@ -86,6 +86,7 @@ rtl_source_c::rtl_source_c (const std::string &args)
     _running(false),
     _no_tuner(false),
     _auto_gain(false),
+    _zero_min_freq(false),
     _if_gain(0),
     _skipped(0)
 {
@@ -228,6 +229,10 @@ rtl_source_c::rtl_source_c (const std::string &args)
   if (ret < 0)
     throw std::runtime_error("Failed to reset usb buffers.");
 
+  if ( strcmp(manufact, "RTLSDRBlog") == 0 && strcmp(product, "Blog V4") == 0) {
+    _zero_min_freq = true;
+  }
+
   set_if_gain( 24 ); /* preset to a reasonable default (non-GRC use case) */
 
   _buf = (unsigned char **)malloc(_buf_num * sizeof(unsigned char *));
@@ -468,18 +473,18 @@ osmosdr::freq_range_t rtl_source_c::get_freq_range( size_t chan )
 
     if ( tuner == RTLSDR_TUNER_E4000 ) {
       /* there is a (temperature dependent) gap between 1100 to 1250 MHz */
-      range += osmosdr::range_t( 52e6, 2.2e9 );
+      range += osmosdr::range_t( _zero_min_freq ? 0 : 52e6, 2.2e9 );
     } else if ( tuner == RTLSDR_TUNER_FC0012 ) {
-      range += osmosdr::range_t( 22e6, 948e6 );
+      range += osmosdr::range_t( _zero_min_freq ? 0 : 22e6, 948e6 );
     } else if ( tuner == RTLSDR_TUNER_FC0013 ) {
-      range += osmosdr::range_t( 22e6, 1.1e9 );
+      range += osmosdr::range_t( _zero_min_freq ? 0 : 22e6, 1.1e9 );
     } else if ( tuner == RTLSDR_TUNER_FC2580 ) {
-      range += osmosdr::range_t( 146e6, 308e6 );
-      range += osmosdr::range_t( 438e6, 924e6 );
+      range += osmosdr::range_t( _zero_min_freq ? 0 : 146e6, 308e6 );
+      range += osmosdr::range_t( _zero_min_freq ? 0 : 438e6, 924e6 );
     } else if ( tuner == RTLSDR_TUNER_R820T ) {
-      range += osmosdr::range_t( 24e6, 1766e6 );
+      range += osmosdr::range_t( _zero_min_freq ? 0 : 24e6, 1766e6 );
     } else if ( tuner == RTLSDR_TUNER_R828D ) {
-      range += osmosdr::range_t( 24e6, 1766e6 );
+      range += osmosdr::range_t( _zero_min_freq ? 0 : 24e6, 1766e6 );
     }
   }
 
diff --git a/lib/rtl/rtl_source_c.h b/lib/rtl/rtl_source_c.h
index 99f14f4..39bb6f6 100644
--- a/lib/rtl/rtl_source_c.h
+++ b/lib/rtl/rtl_source_c.h
@@ -141,6 +141,7 @@ private:
 
   bool _no_tuner;
   bool _auto_gain;
+  bool _zero_min_freq;
   double _if_gain;
   unsigned int _skipped;
 };
-- 
2.40.0

